{"tasks": {
"records":"<%= @tasks.size %>",
"rows": [
<%  total_time = 0
    @tasks.each_with_index do |task, idx|
    cache([ task, current_user.id, task.project.updated_at, task.milestone.try(:updated_at) ]) do
      customer = (task.customers.first || task.project.customer)
-%>
{
<%    readFlag = ""
      total_time += task.minutes_left.to_i
      if (task.unread?(current_user))
        readFlag = "f" # this task is unread
      else if (task.users + task.watchers).include?(current_user) # only users assigned to or watching a task can mark unread
        readFlag = "t" # this task is read and can be switched to unread
      else
        readFlag = "x" # this task doesn't have the current user assigned/cc
      end
    end
-%>
"read":<%= readFlag.to_json.html_safe %>,
"id":<%= task.task_num.to_json.html_safe %>,
<% current_user.company.properties.each do |prop| -%>
<% prop_query = TaskPropertyValue.find_by_task_id_and_property_id(task.id, prop.id).property_value rescue "" -%>
<% prop_value = prop_query == "" ? "<span id='position_#{prop.name.downcase}_9999'></span>": "<span id='position_#{prop.name.downcase}_#{prop_query.position_to_s}'>#{prop_query.to_html}</span>" rescue "" -%>
<%= h(prop.name.downcase).to_json.html_safe %>:<%= prop_value.to_json.html_safe %>,
<%  end -%>
"summary":<%= h(task.name).to_json.html_safe %>,
"resolution":<%= task.status_type.to_json.html_safe %>,
"points":<%= task.total_points.to_json.html_safe %>,
"business_value":<%= task.business_value.to_json.to_i %>
}<% end -%><%= "," unless @tasks.size - 1 == idx  %>
    <% end -%>
],
"userdata":{"points":<%=  @total_points.to_json.html_safe %>,
"business_value":<%=  @total_business_value.to_json.html_safe %>,
"summary":<%=  @tasks.size.to_json.html_safe %>,
"id": "Totals"
}
  }
}